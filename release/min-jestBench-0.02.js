(function(){var t={},n=function(){!function(t){t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return t===Object(t)}}(this);var t=function(){!function(t){t.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return t===Object(t)}}(this);var t=function(){!function(t){var n,e,i,r,o;t.add=function(t,n,i){if(n||i){var r;"[object Array]"===Object.prototype.toString.call(i)?r=i:(r=Array.prototype.slice.call(arguments,2),r||(r=[])),e.push([n,t,r])}else e.push(t)},t.after=function(t,n,e){e||(e="time"+(new Date).getTime()+Math.random(1e7)),r[e]={step:Math.floor(1e3*t),fn:n,nextTime:0,remove:!0}},t.asap=function(t){this.add(t)},t.every=function(t,n,e){e||(e="time"+(new Date).getTime()+Math.random(1e7)),r[e]={step:Math.floor(1e3*t),fn:n,nextTime:0}},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){if(!n){this.polyfill();var t,s;if("undefined"!=typeof window){var t=window.requestAnimationFrame,s=window.cancelRequestAnimationFrame;["","ms","moz","webkit","o"].forEach(function(n){t||(t=window[n+"RequestAnimationFrame"],s=window[n+"CancelAnimationFrame"]||window[n+"CancelRequestAnimationFrame"])})}t||(t=function(t){return setTimeout(t,16)}),s||(s=function(t){clearTimeout(t)}),e=[],i={},r={},o=[];var a=0,c=function(){for(var n,s=(new Date).getTime();n=e.shift();)"[object Array]"===Object.prototype.toString.call(n)?n[1].apply(n[0],n[2]):n();for(var u=0;u<o.length;u++){var l=o[u];l()}for(var f in i)if(i.hasOwnProperty(f)){var h=i[f];h[0](h[1]),delete i[f]}for(var f in r)if(r.hasOwnProperty(f)){var h=r[f];h.nextTime<s&&(h.remove?h.nextTime>0?(h.fn(),delete r[f]):h.nextTime=s+h.step:(h.fn(),h.nextTime=s+h.step)),h.until&&h.until<s&&delete r[f]}t(c),a=s};c(),n=!0}}),t.once=function(t,n,e){i[t]=[n,e]},t.onFrame=function(t){o.push(t)},t.polyfill=function(){},t.removeFrameFn=function(t){var n=o.indexOf(t);return n>=0?(t._onRemove&&t._onRemove(),o.splice(n,1),!0):!1}}(this)},e=function(t,n,i,r,o,s,a,c){var u,l=this;if(!(l instanceof e))return new e(t,n,i,r,o,s,a,c);var f=[t,n,i,r,o,s,a,c];if(l.__factoryClass)if(l.__factoryClass.forEach(function(t){u=t.apply(l,f)}),"function"==typeof u){if(u._classInfo.name!=e._classInfo.name)return new u(t,n,i,r,o,s,a,c)}else if(u)return u;l.__traitInit?l.__traitInit.forEach(function(t){t.apply(l,f)}):"function"==typeof l.init&&l.init.apply(l,f)};e._classInfo={name:"later"},e.prototype=new t,function(t){t.all=function(t){var e;e=this.isArray(t)?t:Array.prototype.slice.call(arguments,0);var i=e.length,r=0,o=[],s=new Array(i);return this.then(function(){var t=n();return 0==e.length&&t.resolve([]),e.forEach(function(n,e){n.then?(o.push(n),n.then(function(n){s[e]=n,r++,r==i&&t.resolve(s)},function(n){t.reject(n)})):t.reject("Not list of promises")}),t})},t.collect=function(t,e,i){var r;r=this.isArray(e)?e:[e];var o=r.length,s=!1,a=!1,c=0,u=[],l=i||{};return this.then(function(){var e=n();return r.forEach(function(n){n.then?(u.push(n),n.then(function(n){c++,s=t(n,l),(s&&!a||0==a&&o==c)&&(e.resolve(l),a=!0)},function(t){e.reject(t)})):e.reject("Not list of promises")}),e})},t.fail=function(t){return this.then(null,t)},t.fulfill=function(t){if(!(this._rejected||this._fulfilled&&t!=this._stateValue)){this._fulfilled=!0,this._stateValue=t;for(var n=this._childPromises.length;n--;){var e=this._childPromises.shift();if(e._onFulfill)try{var i=e._onFulfill(t);"undefined"!=typeof i?e.resolve(i):e.fulfill(t)}catch(r){e.reject(r)}else e.fulfill(t)}this._state=1,this.triggerStateChange()}},t.genPlugin=function(t,e){this.plugin(t,function(){var t=Array.prototype.slice.call(arguments,0);console.log("Plugin args",t);var i=n();return this.then(function(){var n=Array.prototype.slice.call(arguments,0),r=t.concat(n),o=e.apply(this,r);i.resolve(o)},function(t){i.reject(t)}),i})},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,n){if(this._state=0,this._stateValue=null,this._isAPromise=!0,this._childPromises=[],this.isFunction(t)&&(this._onFulfill=t),this.isFunction(n)&&(this._onReject=n),!n&&this.isFunction(t)){var i=this;e().asap(function(){console.log("--- calling the onFulfilled "),t(function(t){i.resolve(t)},function(t){i.resolve(t)})})}}),t.isFulfilled=function(){return 1==this._state},t.isPending=function(){return 0==this._state},t.isRejected=function(){return 2==this._state},t.nodeStyle=function(t,n){this.plugin(t,function(){var t,e,i=Array.prototype.slice.call(arguments,0),r=0;i.length>=0&&(t=i[i.length-1],"[object Function]"==Object.prototype.toString.call(t)&&(e=t,r=i.length-1));var o=wishes().pending();return this.then(function(){var t=wishes().pending(),s=Array.prototype.slice.call(arguments,0);console.log("Orig args",i),console.log("Then args",s);var a;0==i.length&&(a=s),0==s.length&&(a=i),a||(a=s.concat(i)),r=a.length,e&&r--,a[r]=function(n){if(n)return console.log("Got error ",n),t.reject(n),void o.reject(n);if(e){var i=Array.prototype.slice.call(arguments),r=e.apply(this,i);o.resolve(r)}else{var i=Array.prototype.slice.call(arguments,1);o.resolve.apply(o,i)}},t.then(function(t){o.resolve(t)}),console.log("nodeStyle after concat",a);n.apply(this,a);return t},function(t){o.reject(t)}),o})},t.onStateChange=function(t){this._listeners||(this._listeners=[]),this._listeners.push(t)},t.plugin=function(n,e){return t[n]=e,this},t.props=function(t){var n=[];for(var e in t)t.hasOwnProperty(e)&&n.push({name:e,promise:t[e]});var i=n.length,r=0,o=[],s={};return this.then(function(){var t=wishes().pending();return n.forEach(function(n){var e=n.promise,a=n.name;e.then?(o.push(e),e.then(function(n){s[a]=n,r++,r==i&&t.resolve(s)},function(n){t.reject(n)})):t.reject("Not list of promises")}),t})},t.reject=function(t){if(!(this._fulfilled||this._rejected&&t!=this._rejectReason)){this._state=2,this._rejected=!0,this._rejectReason=t;for(var n=this._childPromises.length;n--;){var e=this._childPromises.shift();if(e._onReject)try{e._onReject(t),e.reject(t)}catch(i){e.reject(i)}else e.reject(t)}this.triggerStateChange()}},t.rejectReason=function(t){return t?void(this._rejectReason=t):this._rejectReason},t.resolve=function(t){if(!(this._state>0)){if(t==this)return this._rejectReason="TypeError",void this.reject(this._rejectReason);if(this.isObject(t)&&t._isAPromise){if(this._state=t._state,this._stateValue=t._stateValue,this._rejectReason=t._rejectReason,0===this._state){var n=this;t.onStateChange(function(){1==t._state&&n.resolve(t.value()),2==t._state&&n.reject(t.rejectReason())})}return 1==this._state&&this.fulfill(this._stateValue),void(2==this._state&&this.reject(this._rejectReason))}if(this.isObject(t)&&t.then&&this.isFunction(t.then)){var e=!1;try{var n=this;t.then.call(t,function(t){e||(n.resolve(t),e=!0)},function(t){e||(n.reject(t),e=!0)})}catch(i){e||this.reject(i)}}else this._state=1,this._stateValue=t,this.fulfill(t)}},t.state=function(t){return"undefined"!=typeof t&&(this._state=t),this._state},t.then=function(t,i){i||(i=function(){});var r=new n(t,i),o=this;return 1==this._state&&e().asap(function(){o.fulfill(o.value())}),2==this._state&&ater().asap(function(){o.reject(o.rejectReason())}),this._childPromises.push(r),r},t.triggerStateChange=function(){var t=this;this._listeners&&(this._listeners.forEach(function(n){n(t)}),this._listeners.length=0)},t.value=function(t){return"undefined"!=typeof t?(this._stateValue=t,this):this._stateValue}}(this)},n=function(t,e,i,r,o,s,a,c){var u,l=this;if(!(l instanceof n))return new n(t,e,i,r,o,s,a,c);var f=[t,e,i,r,o,s,a,c];if(l.__factoryClass)if(l.__factoryClass.forEach(function(t){u=t.apply(l,f)}),"function"==typeof u){if(u._classInfo.name!=n._classInfo.name)return new u(t,e,i,r,o,s,a,c)}else if(u)return u;l.__traitInit?l.__traitInit.forEach(function(t){t.apply(l,f)}):"function"==typeof l.init&&l.init.apply(l,f)};n._classInfo={name:"_promise"},n.prototype=new t;var e=function(){!function(t){t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return t===Object(t)}}(this);var t=function(){!function(t){t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return t===Object(t)}}(this),function(t){t.addRows=function(t){var e=n(),i=this._db.transaction([this._table],"readwrite");i.oncomplete=function(){e.resolve(!0)},i.onerror=function(t){e.reject(t)};var r=i.objectStore(this._table);for(var o in t){var s=r.add(t[o]);s.onsuccess=function(){}}return e},t.clear=function(){var t=n(),e=this._db.transaction(this._table,"readwrite"),i=e.objectStore(this._table),r=i.clear();return r.onerror=function(n){t.fail(n.target.errorCode)},r.onsuccess=function(){t.resolve(!0)},t},t.count=function(){var t=n(),e=this._db.transaction([this._table],"readonly");return e.objectStore(this._table).count().onsuccess=function(n){t.resolve(n.target.result)},t},t.forEach=function(t){var n=this._db.transaction(this._table,"readwrite"),e=n.objectStore(this._table);n.oncomplete=function(){};var i=e.openCursor();i.onerror=function(t){console.log(t)},i.onsuccess=function(n){var e=n.target.result;e&&(t(e.value,e),e.continue())}},t.get=function(t){var e=n(),i=this._db.transaction(this._table,"readonly"),r=i.objectStore(this._table),o=r.get(t);return o.onerror=function(n){console.log("Could not get ",t),e.fail(n.target.errorCode)},o.onsuccess=function(){e.resolve(o.result)},e},t.getAll=function(){var t=n(),e=this._db.transaction(this._table,"readonly"),i=e.objectStore(this._table),r=[];e.oncomplete=function(){t.resolve(r)};var o=i.openCursor();return o.onerror=function(t){console.log(t)},o.onsuccess=function(t){var n=t.target.result;n&&(r.push(n.value),n.continue())},t},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,n){this._db=t,this._table=n}),t.readAndDelete=function(){var t=n(),e=this._db.transaction(this._table,"readwrite"),i=e.objectStore(this._table),r=[];e.oncomplete=function(){t.resolve(r)};var o=i.openCursor();return o.onerror=function(t){console.log(t)},o.onsuccess=function(t){var n=t.target.result;n&&(r.push(n.value),n.delete(),n.continue())},t},t.update=function(t,e){var i=n(),r=this,o=this._db.transaction([this._table],"readwrite"),s=o.objectStore(this._table);try{var a=s.get(t);a.onerror=function(t){return a.result?void i.fail(t.target.errorCode):void r.addRows([e]).then(function(){i.resolve(e)})},a.onsuccess=function(){if(!a.result)return void r.addRows([e]).then(function(){i.resolve(e)});var t=s.put(e);t.onerror=function(){i.fail("update failed ")},t.onsuccess=function(){i.resolve(e)}}}catch(c){return this.addRows([e])}return i}}(this)},e=function(t,n,i,r,o,s,a,c){var u,l=this;if(!(l instanceof e))return new e(t,n,i,r,o,s,a,c);var f=[t,n,i,r,o,s,a,c];if(l.__factoryClass)if(l.__factoryClass.forEach(function(t){u=t.apply(l,f)}),"function"==typeof u){if(u._classInfo.name!=e._classInfo.name)return new u(t,n,i,r,o,s,a,c)}else if(u)return u;l.__traitInit?l.__traitInit.forEach(function(t){t.apply(l,f)}):"function"==typeof l.init&&l.init.apply(l,f)};e._classInfo={name:"dbTable"},e.prototype=new t,function(t){var n,r,o;t._initDB=function(){o||(o=window.indexedDB,n=!0,r=i("sys.db",{tables:{databases:{createOptions:{keyPath:"name"}}}}))},t.clearDatabases=function(t){r.then(function(){var n=r.table("databases");n.forEach(function(n,e){t(n)&&(o.deleteDatabase(n.name),e.delete())})})},t.createTable=function(t,n){this._db.createObjectStore(t,n);return this.table(t)},t.getDB=function(){return this._db},t.getStore=function(t,n){var e=this._db.transaction(t,n);return e.objectStore(t)},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,n){if(!this._db&&(this._initDB(),t)){var e=this,i=o.open(t,4);i.onerror=function(t){console.error(t.target.errorCode)},i.onsuccess=function(n){r.then(function(){var n=r.table("databases");n.addRows([{name:t}])}),e._db=n.target.result,e.resolve(!0)},i.onupgradeneeded=function(t){var i=t.target.result;if(e._db=i,n&&n.tables)for(var r in n.tables)if(n.tables.hasOwnProperty(r)){var o=n.tables[r];i.createObjectStore(r,o.createOptions)}}}}),t.table=function(t){return e(this._db,t)}}(this)},i=function(t,n,e,r,o,s,a,c){var u,l=this;if(!(l instanceof i))return new i(t,n,e,r,o,s,a,c);var f=[t,n,e,r,o,s,a,c];if(l.__factoryClass)if(l.__factoryClass.forEach(function(t){u=t.apply(l,f)}),"function"==typeof u){if(u._classInfo.name!=i._classInfo.name)return new u(t,n,e,r,o,s,a,c)}else if(u)return u;l.__traitInit?l.__traitInit.forEach(function(t){t.apply(l,f)}):"function"==typeof l.init&&l.init.apply(l,f)};e.prototype=n.prototype,i._classInfo={name:"_localDB"},i.prototype=new e;var r=function(){!function(t){t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return t===Object(t)}}(this),function(t){var e;t.hasOwnProperty("__factoryClass")||(t.__factoryClass=[]),t.__factoryClass.push(function(t,n){return t===!1&&n?void 0:(e||(e={}),e[t]?e[t]:void(e[t]=this))}),t.addCommands=function(t,n){if(this.isArray(t)){var e=this;return t.forEach(function(t){e.addCommands(t)}),this}this._commands.push({fnCmd:t,fnFail:n,async:!0})},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,n){this._commands||(this._commands=[],this.waitingList=[],this._index=0);var e=this;n||later().every(1/30,function(){e.step()})}),t.step=function(){var t=this._index,e=this._commands.length;if(t!=e){for(var i=n(),r=i,o=n(),s=this;e>t;){var a=this._commands[t];!function(t){r=r.then(function(){var e=n();return t.fnCmd(function(){e.resolve(!0)},function(n){e.resolve(!0),t.fnFail&&t.fnFail(n)}),e}).fail(function(n){t.fnFail&&t.fnFail(n)})}(a),this._index++,t++}return r.then(function(){if(s.waitingList.shift(),o.resolve(!0),s.waitingList.length){var t=s.waitingList[0];t.resolve(!0)}}).fail(function(){}),this.waitingList.push(i),1==this.waitingList.length&&i.resolve(!0),o}}}(this)},o=function(t,n,e,i,r,s,a,c){var u,l=this;if(!(l instanceof o))return new o(t,n,e,i,r,s,a,c);var f=[t,n,e,i,r,s,a,c];if(l.__factoryClass)if(l.__factoryClass.forEach(function(t){u=t.apply(l,f)}),"function"==typeof u){if(u._classInfo.name!=o._classInfo.name)return new u(t,n,e,i,r,s,a,c)}else if(u)return u;l.__traitInit?l.__traitInit.forEach(function(t){t.apply(l,f)}):"function"==typeof l.init&&l.init.apply(l,f)};o._classInfo={name:"sequenceStepper"},o.prototype=new r,function(t){t.fiddle=function(t,n){var e=document.createElement("IFRAME"),i=this.guid(),r=decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chead%3E");if(t.scripts&&t.scripts.forEach(function(t){r+=decodeURIComponent("%3Cscript%20src%3D'")+t+decodeURIComponent("'%3E%3C%2Fscript%3E")}),t.stylesheets&&t.stylesheets.forEach(function(t){r+='<link rel="stylesheet" href="'+t+'"></link>'}),t.head&&(r+=t.head),r+="</head><body>",t.callBackName||(t.callBackName="fiddleDone"),t.onReady&&t.callBackName){var o=window.localStorage,s=function(){var n;(n=o.getItem(i))&&(later().removeFrameFn(s),t.onReady(JSON.parse(n)))};later().onFrame(s),r+=decodeURIComponent("%3Cscript%3E")+"function "+t.callBackName+"(v){window['localStorage'].setItem('"+i+"', JSON.stringify(v));}",r+=decodeURIComponent("%3C%2Fscript%3E")}t.html&&(r+=t.html),t.jsCode&&(r+=decodeURIComponent("%3Cscript%3E")+t.jsCode+decodeURIComponent("%3C%2Fscript%3E")),r+="</body></html>",n?n.appendChild(e):document.body.appendChild(e),e.contentWindow.document.open(),e.contentWindow.document.write(r),e.contentWindow.document.close();var a=e.style;return a.width=(t.width||800)+"px",a.height=(t.height||600)+"px",e},t.getDbResults=function(t,n){var e=i(t,{tables:{sessions:{createOptions:{autoIncrement:!0}}}});e.then(function(){e.table("sessions").getAll().then(function(t){n(t)}).fail(function(){n(null)})})},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t){this._options=t}),t.runTests=function(t){var n=this;this._results=[];var e=t.tests.length,i=0,r=o();t.tests.forEach(function(o){var s,a="";a+="try {",t.timeOut||(t.timeOut=1500),t.timeOut&&(a+="\n setTimeout( function() { fiddleDone({result : false, exception:true, text :'timeout "+t.timeOut+"ms' }); }, "+t.timeOut+");\n"),t.prepCode&&(a+=";\n"+t.prepCode+";\n"),a+="string"==typeof o?"(function(testResults) {"+o+"})(fiddleDone)":"("+o.toString()+")(fiddleDone)",a+="\n} catch(e) { fiddleDone({result : false, exception:true, text : e.message }); } ",r.addCommands(function(r){var o={stylesheets:t.stylesheets||[],scripts:t.scripts||[],html:t.html||"",jsCode:a,width:t.width||800,height:t.height||600,onReady:function(o){n._results.push(o),s.parentNode.removeChild(s),r(),i++,i==e&&(t.onReady&&t.onReady(n._results),t.toIndexedDB&&n.saveToIndexed(t.toIndexedDB,n._results,t.description))}};s=n.fiddle(o)})})},t.saveToIndexed=function(t,n,e){var r=i(t,{tables:{sessions:{createOptions:{autoIncrement:!0}}}});r.then(function(){r.table("sessions").addRows([{testRunUTC:(new Date).getTime(),extra:e||{},results:n}])})}}(this)},e=function(t,n,i,r,o,s,a,c){var u,l=this;if(!(l instanceof e))return new e(t,n,i,r,o,s,a,c);var f=[t,n,i,r,o,s,a,c];if(l.__factoryClass)if(l.__factoryClass.forEach(function(t){u=t.apply(l,f)}),"function"==typeof u){if(u._classInfo.name!=e._classInfo.name)return new u(t,n,i,r,o,s,a,c)}else if(u)return u;l.__traitInit?l.__traitInit.forEach(function(t){t.apply(l,f)}):"function"==typeof l.init&&l.init.apply(l,f)};e._classInfo={name:"jestBench"},e.prototype=new n,function(){"undefined"!=typeof define&&null!==define&&null!=define.amd?(t.jestBench=e,this.jestBench=e):"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports.jestBench=e:this.jestBench=e}.call(new Function("return this")()),"undefined"!=typeof define&&null!==define&&null!=define.amd&&define(t)}).call(new Function("return this")());